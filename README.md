#### 工资条多银多渠道设计思路
>##### 运营主体
- 为银行提供单独提供公众号运营    【尧都农商】
- 为银行某特定企业提供工资条接入  【华夏中人联】
- 放薪管家自已公众号运营     
>##### 数据权限
- 只显示接入银行全部数据
- 放薪管家可以查看全数据



#### 多银行支持
- 微信公众号 
   - URL 需要增加  ?id=[对接方]
   ```
   https://b530391e.ngrok.io/weixin/signature?id=FXGJ
   https://b530391e.ngrok.io/weixin/signature
   ``` 
- 前端修改
  ```
   【1】weixin/wxCallback/ RequestParam参数增加 appPartner ，后端提供给前端
   【2】weixin/wxCallback/ 此接口，增加  合作方编号 apppartner   合作方描述 apppartnerDesc
   【3】前端 接收【2】返回的值，后续交易时，放入header中，
  ```
- 公共报文头上增加  接入方

- 根据接入方 判断员工的数据权限

- logback.xml 增加 接入方打印

- [todo] mogodb  增加 接入方打印


修改前：
- https://sitwx.cardpu.com/weixin/signature   1234567890

- sitwxp.cardpu.com

- sitwxp.cardpu.com

修改后：
 
 接口配置信息
 
 - https://sitgateway.cardpu.com/payroll/weixin/signature   1234567890
 
 JS接口安全域名
 
 - sitgateway.cardpu.com
 
 OAuth2.0网页授权

 - sitgateway.cardpu.com

#### 2019年06月20日版本
##### 上线说明
- 【新需求】支持 多合作方模式下查看工资条
- 【新需求】轮播图修改，按合作方显示
- 【新需求】工资条查看资金发放方的显示，改成 按企业配置动态显示。
- 【新需求】日志打印时，可以显示出 合作方明名称

- 【bug优化】催促分配客户经理

#### 2019年06月19日版本
##### 上线说明
- 【bug优化】删除员工查看工资条
    工资列表， 工资明细 改为 按 用户身份证查询
    sql使用了 身份证 索引条件
    之前设计是按 用户id进行查询，但用户被多次删除后，就无法看到之前的代发记录
    如果sql使用in的方式，索引失效、则查询效率不高


#### 2019年04月08日版本
##### 上线说明
- 后端框架升级 springboot 2.1.2.RELEASE + springcloud Greenwich.RC2 
- 框架升级后，影响监控平台参数指标
- 后端换成 webflux 响应式开发
- 前端修改 error对象
- 涉及工资等信息时，由只读库 --> 写库,去了 rs-inside 这一层
- 涉及微信平台交互依然保持不变，依然访问rs-inside
- 此版本不涉及网关访问

##### 生产运维
- 网络部署架构保持不变
   - 由原来访问读库 变成 写库
   - 通过nginx 转发到后端应用
- consul注册中心，注册
- springboot 2.0健康指标参数变更
- nginx 去掉 rest访问
- 生产配置文件（内存 等）
- 启动脚本
- 项目git地址
- 新项目可以提前编译项目


##### 检查点
- [ ] mogodb日志检查
- [ ] 配置文件检查
- [ ] 微信分享


##### 问题
- [ ] 轮播图访问设计不合理，URL 、缓存
- [ ] 同事理财团 未认证时报错
- [ ] 红包菜单下线
- [ ] 访问时无工资明细

##### 上线总结
- 新项目地址没有明确给运维，导致项目工程引用错误
- 运维监控端口配置错误
- 工资条由写库改成读库时，新增字段，未创建，配置文件。
- 上线第二天生产问题总结
  - 问题：部分员工查询工资条列表时报错。  
    原因：从缓存取值后反序列化错误导致。  
    解决方案：不查缓存，直接查库。
  - 问题：IOS系统版本10.3以下的用户，点我的工资条后白屏。  
    原因：前端模拟数据时有控制，未放开导致。  
    解决方案：前端去除控制。


##### 运维健康
- consul注册中心， 监控和检查
- 筛选交易对比 交易耗时





#### 2019 下一版本
- 同事理财团，图片问题
- 轮播图
- 微信通过rs-ids
- 通过网关访问
- 工资信息通过mongodb访问